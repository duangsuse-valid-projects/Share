# 手把手教你设计动画时钟动态壁纸

> 这篇文章假定你只是手写过简单 HTML ，有基础的 __编辑-预览能力__，拓展知识会提前阐述。

昨天看到一个有意思的动态桌面，是个纵向滑移数字/数位的时分秒钟，长[这样](js/fortun.js)：

非常可爱，简直就像小天使！我自己也打算设计一个；不过如果只是那样就没啥意思了，我决定教教你们怎么写。

自己马上要能实现「大佬」才能做出来的漂亮动画，想想有没有点小激动？ 😆

## 前置知识

你可能不知道什么是 DOM ，但应该知道 HTML 和 CSS 。数字时钟要用 HTML 显示文字，然后让 CSS 调整文字显示样式、添加动画。

如果你不太习惯写 HTML ，我们复习下它最主要的三类标签：

+ 配对标签 `<div attr1="value1"></div>`
+ 单独标签 `<br> <hr>` (有人也加斜杠，会被容错处理)
+ 折叠标签 `<meta charset="utf-8"/> <img src="url" />`

如果用一种尽可能简单，或者说突出本质的方法描述这三项所「定义的所有信息」是怎样？

+ 配对标签 `el("div", {attr1: value1}, [])` ，这蕴含了标签名、属性 键名-取值对、子标签列表
+ 单独标签 `el("br")` ，这蕴含了标签名
+ 折叠标签 `el("img", {src: url})` ，这蕴含了标签名和属性[键-值对]

第一种标签是最总体的情况(整体并集,即全集)，构造出它的三个要素我们称之为 `tagName,attribute,children` 。

对(0取止 `children.length`)里的i，`children[i]` 都是同样有这三种要素的『节点(Node)』。

整个 HTML 文档由三元素节点和文本节点的嵌套、树形列表组成，通过 JS 脚本修改标签属性、子项目元素和 CSS 属性来动态变更文档，我们称之为 <abbr title="文档对象模型">DOM</abbr> 操作。

## JS 前置知识

基础数据访问(即读写)语法、简易计算与逻辑判定。你需要操作 DOM style 和读写存储程序配置的对象，尽管很多时候是 `e.style.textDecoration="underline"` 这样的固定模式访问，这些事情迟早要明白。

需要知道 `let a={age: 18}; a.age==18` ，它等价 `{age:18}["age"]==18` ； (a=b) 是赋名字a以值b ， (a==b) 则是判断ab相等。

`a.sub={rel: "linked"}` 赋值后 `a.sub.rel=="linked"` ，它是先访问 `(a.sub)` 得到一个类似 a 本身的数据对象 `o`，再 `o.rel` 得到文本(字符串) "linked"
即 `let o=a.sub; o.rel=="linked"` ，对上面 `let es=e.style; es.textDecoration=value` 的也是一样。

### 函数，也即子程序

人类的能力是有限的，无论怎么补脑都有处理不了的复杂结构。 ~~所以我不做人了！JOJO！~~

为了研究更大、更复杂的情况和规律，我们必须把问题分而治之。不会利用 `function` 的程序员都是神经病，他们写出的代码非常难看难懂，会给未来的工作造成一大堆麻烦，真的。

```js
function putName(o) { console.log(o.name); }
// 三部分： 名字(putName) 参数(1:o) 、 {}内的函数体
// 函数就是有些许参数和一个输出值的程序片段(子程序)。

add1 = function(n) { return n+1 };
// 这个函数可作为值使用，如果不 add1 = 它; ， (它)(1) 也是可执行的
add1 = (n)=>n+1; // (n)=>n 「箭头函数」是以上情况的一种简写
add1(1) == 2

add1(1) == (n=>n+1)(1) // ( ) () 调用函数值
```

函数不一定要有名字才能使用，它们可以在任何地方被创建、在任何数据中引用，只要能简化程序就可以随意使用无名函数(即闭包,closure)。

另外，这次我们要用到 for(of) 和 while 循环，稍后会即地解释。

## 分析更新方法

你可能不理解任何可见标签都有的 CSS 的控件盒模型(左右顶底,padding-content,margin-border)，但应该学过直角坐标系。编写纵向滑移的 CSS 动画必须理解这点。

现在我告诉你，每个类似 <p> 和 <img> 的 DOM 节点都支持直角坐标系，它们是直角坐标系里的元素，不过是从页面视口(client)左上角往右、往下数(x,y)=(left,top)点的。
it.style.left=it.clientX+"px"; it.style.top=it.clientY+"px";
不过，HTML 默认不支持手动选择元素位置，需要添加 CSS属性 position:absolute; 到修改的元素，JS 上操作为 it.style.position="absolute";

之前我写了几个基于 interval update (时差更新) 的 Web DOM/CSS/JS 动画，所以觉得这个好像也是要隔一秒(1s) 完整重绘，但其实 考虑时间 08:24:33 ，每一位都含有纵滑动画，如果完整重绘就不可能单独动画数字了，所以逻辑很简单：

+ 每秒让如 24:33 的秒位 +1 (下滑)
+ 每位滑完列表皆回滚，且让上一位下滑（自动进位制，不论是对 0~9 还是 0~60 都有效）
+ 第一次设置好滑条位置，拆分好两位 0~9 的秒数、 0~60 的时分数

整个钟是由横向排列、正在下滑的『数位』动画构成的，首先，我们需要单独编写可以用的下滑动画。

## 策略到计算机的桥梁-API

此外有个刚才咱忽略了的细节，控件是有宽高限制的，也就是说必须做两个纵向的渐变，数字从边框向内颜色渐渐变浓，这个实现大概是靠。

## 支持用户设置时间格式

刚刚实现的版本写死了 hour:minute:second，其实编程界有个很巧妙的设计让用户能轻易自定义显示格式——格式字符串

## 略 tricky 的读数位方法
